<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<link rel="import" href="../catalog/clinical/opencga-clinical-analysis-browser.html">
<link rel="import" href="../opencga-message-dialog.html">

<dom-module id="variant-report-filter">
    <template>
        <style include="jso-styles">
            label {
                padding-top: 10px;
            }
            .labelReportFilter {
                display: block;
            }
        </style>

        <div class="panel-group" id="{{prefix}}Accordion" role="tablist" aria-multiselectable="true">
            <!-- Analysis Information -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="{{prefix}}GeneralHeading">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                           href="#{{prefix}}FillInputsGeneral"
                           aria-expanded="true" aria-controls="{{prefix}}General">
                            Personal Information
                        </a>
                    </h4>
                </div>

                <div id="{{prefix}}FillInputsGeneral" class="panel-collapse collapse in" role="tabpanel"
                     aria-labelledby="{{prefix}}GeneralHeading">
                    <div class="panel-body">
                        <div id="{{prefix}}FillInputsGeneralDiv">
                            <label class="labelReportFilter">Service petitioner:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}ApplicantInput" id="{{prefix}}ApplicantInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.applicant::input}}">
                            <label class="labelReportFilter">Departament:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}DepartmentInput" id="{{prefix}}DepartmentInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.department::input}}">
                            <label class="labelReportFilter">Province:</label>
                            <select id="{{prefix}}CityInput" name="{{prefix}}CityInput"
                                    class$="form-control input-sm {{prefix}}CityInput" value="{{dataFields.city::input}}">
                                <option value="Almería">Almería</option>
                                <option value="Cádiz">Cádiz</option>
                                <option value="Córdoba">Córdoba</option>
                                <option value="Granada">Granada</option>
                                <option value="Huelva">Huelva</option>
                                <option value="Jaén">Jaén</option>
                                <option value="Málaga">Málaga</option>
                                <option value="Sevilla">Sevilla</option>
                            </select>
                            <label class="labelReportFilter">Patient:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}PatientInput" id="{{prefix}}PatientInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.patient::input}}">
                            <label class="labelReportFilter">NUHSA:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}nuhsaInput" id="{{prefix}}nuhsaInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.nuhsa::input}}">
                            <label class="labelReportFilter">Family Number:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}FamilyNumberInput" id="{{prefix}}FamilyNumberInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.familyNumber::input}}">
                            <label class="labelReportFilter">Analysis type:</label>
                            <select id="{{prefix}}AnalysisTypeSelect" name="{{prefix}}AnalysisTypeSelect"
                                    class$="form-control input-sm {{prefix}}AnalysisTypeSelect" value="{{dataFields.analysisType::input}}">
                                <option value="{{loadi18n('diagnosis')}}">{{loadi18n('diagnosis')}}</option>
                                <option value="{{loadi18n('carrier')}}">{{loadi18n('carrier')}}</option>
                                <option value="{{loadi18n('presymptomatic')}}">{{loadi18n('presymptomatic')}}</option>
                            </select>
                            <label class="labelReportFilter">Entry date:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}EntryDateInput" id="{{prefix}}EntryDateInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.entryDate::input}}">
                            <label class="labelReportFilter">Birth Year:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}nuhsaInput" id="{{prefix}}birthYear" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.birthYear::input}}">
                            <label class="labelReportFilter">Relationship:</label>
                            <select id="{{prefix}}RelationshipSelect" name="{{prefix}}RelationshipSelect" on-change="changeRelationshipSelect"
                                    class$="form-control input-sm {{prefix}}RelationshipSelect" value="{{dataFields.relationship::input}}">
                                <option value="{{loadi18n('proband')}}">Proband</option>
                                <option value="{{loadi18n('sonof')}}">Son of</option>
                                <option value="{{loadi18n('daughterof')}}">Daughter of</option>
                                <option value="{{loadi18n('brotherof')}}">Brother of</option>
                                <option value="{{loadi18n('sisterof')}}">Sister of</option>
                                <option value="{{loadi18n('motherof')}}">Mother of</option>
                                <option value="{{loadi18n('fatherof')}}">Father of</option>
                                <option value="{{loadi18n('other')}}">Other</option>
                            </select>
                            <input type="text" class$="form-control input-sm {{prefix}}extraRelationship" id="{{prefix}}extraRelationship" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.extraRelationship::input}}" style="display: none; margin-top: 2%;">
                            <label class="labelReportFilter">Physician one:</label>
                            <select id="{{prefix}}SignLeftSelect" name="{{prefix}}SignLeftSelect"
                                    class$="form-control input-sm {{prefix}}SignLeftSelect" value="{{dataFields.signLeft::input}}" on-change="changeSign">
                                <option value="{{loadi18n('dr')}}{{loadi18n('antinolo')}}">{{loadi18n('dr')}}{{loadi18n('antinolo')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('borrego')}}">{{loadi18n('dra')}}{{loadi18n('borrego')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('mendez')}}">{{loadi18n('dra')}}{{loadi18n('mendez')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('bravo')}}">{{loadi18n('dra')}}{{loadi18n('bravo')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('fernandez')}}">{{loadi18n('dra')}}{{loadi18n('fernandez')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('marcos')}}">{{loadi18n('dra')}}{{loadi18n('marcos')}}</option>
                            </select>
                            <label class="labelReportFilter">Physician two:</label>
                            <select id="{{prefix}}SignRightSelect" name="{{prefix}}SignRightSelect"
                                    class$="form-control input-sm {{prefix}}SignRightSelect" value="{{dataFields.signRight::input}}" on-change="changeSign">
                                <option value="{{loadi18n('dr')}}{{loadi18n('antinolo')}}">{{loadi18n('dr')}}{{loadi18n('antinolo')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('borrego')}}">{{loadi18n('dra')}}{{loadi18n('borrego')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('mendez')}}">{{loadi18n('dra')}}{{loadi18n('mendez')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('bravo')}}">{{loadi18n('dra')}}{{loadi18n('bravo')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('fernandez')}}">{{loadi18n('dra')}}{{loadi18n('fernandez')}}</option>
                                <option value="{{loadi18n('dra')}}{{loadi18n('marcos')}}">{{loadi18n('dra')}}{{loadi18n('marcos')}}</option>
                            </select>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Analysis Information -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="{{prefix}}SampleAnalysisHeading">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                           href="#{{prefix}}AnalysisSelector"
                           aria-controls="{{prefix}}AnalysisSelector">
                            Analysis
                        </a>
                    </h4>
                </div>

                <div id="{{prefix}}AnalysisSelector" class="panel-collapse collapse" role="tabpanel"
                     aria-labelledby="{{prefix}}SampleFilterHeading">
                    <div class="panel-body">
                        <div id="{{prefix}}analysisSelectedDiv">
                            <label class="labelReportFilter">Analysis selected:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}FilterTextInput" id="{{prefix}}FilterTextInput"
                                   placeholder="{{currentAnalysisID}}" aria-describedby="basic-addon1" disabled>
                        </div>
                        <div id="{{prefix}}reasonConsultationHeaderDiv">
                            <label class="labelReportFilter">Presenting complaint:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}ReasonConsultationTextInput" id="{{prefix}}ReasonConsultationTextInput" placeholder="___"
                                   placeholder="{{currentAnalysisID}}" aria-describedby="basic-addon1" value="{{dataFields.reasonConsultation::input}}">
                        </div>
                        <div id="{{prefix}}analysisResumeDiv" hidden>
                            <input type="checkbox" name="analysisButtons" id="{{prefix}}AnalysisResume"
                                   value="analysisResume" class$="{{prefix}}FilterRadio" on-change="showAnalysisResume"
                                   style="padding-left: 20px"> Analysis Summary<br>
                        </div>
                        <label class="labelInheritanceMode">Inheritance Mode:</label>
                        <select
                                    id="{{prefix}}InheritanceMode"
                                    name="{{prefix}}InheritanceMode"
                                    class$="form-control input-sm {{prefix}}InheritanceMode"
                                    value="{{dataFields.inheritance::input}}"
                                    disabled="{{interpretation.attributes.inheritance}}">
                            <option value="autoDominant">Autosomal Dominant</option>
                            <option value="autoRecessive">Autosomal Recessive</option>
                            <option value="xLinked">x-Linked</option>
                        </select>
                        <label class="labelInheritanceMode">Prenatal Mode:</label>
                        <select
                                id="{{prefix}}PrenatalMode"
                                name="{{prefix}}PrenatalMode"
                                class$="form-control input-sm {{prefix}}PrenatalMode"
                                value="{{dataFields.inheritancePrenatal::input}}"
                                disabled="[[!isParentalModeEnabled(dataFields.inheritance)]]">
                            <option value="">Select...</option>
                            <template is="dom-repeat" items="{{prenatalModes}}" as="mode">
                                <option value="{{mode.id}}">{{mode.value}}</option>
                            </template>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Interpretation -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="{{prefix}}InterpretationHeading">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                           href="#{{prefix}}InterpretationContent"
                           aria-expanded="true" aria-controls="{{prefix}}Interpretation">
                            Interpretation
                        </a>
                    </h4>
                </div>

                <div id="{{prefix}}InterpretationContent" class="panel-collapse collapse" role="tabpanel"
                     aria-labelledby="{{prefix}}InterpretationHeading">
                    <div class="panel-body">
                        <div id="{{prefix}}FillInputsInterpretationDiv">
                            <label class="labelReportFilter">Depth:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}DepthInput" id="{{prefix}}DepthInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.depth::input}}">
                            <label class="labelReportFilter">Coverage:</label>
                            <input type="text" class$="form-control input-sm {{prefix}}CoverageInput" id="{{prefix}}CoverageInput" placeholder="___"
                                   aria-describedby="basic-addon1" value="{{dataFields.coverage::input}}">

                            <label class="labelReportFilter">Interpretation Comments (Only for positive diagnosis):</label>
                            <textarea type="text" class$="form-control input-sm {{prefix}}extraInfoInput" id="{{prefix}}extraInfoInput" placeholder="___"
                                       rows="5" value="{{dataFields.extraInterpretation::input}}"></textarea>
                                       <br>
                            <textarea type="text" class$="form-control input-sm {{prefix}}extraCommentsInput" id="{{prefix}}extraCommentsInput" placeholder="___"
                                        rows="5" value="{{dataFields.extraInterpretationComments::input}}"></textarea>
                            <!-- InterpretationDetectionAdvice -->
                            <label class="labelReportFilter">Genetic advice:</label>
                            <textarea type="text" class$="form-control input-sm {{prefix}}DetectionAdviceInput" id="{{prefix}}DetectionAdviceInput" placeholder="___"
                                        rows="5" value="{{dataFields.InterpretationDetectionAdvice::input}}"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Methodology -->
            <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="{{prefix}}MethodologyHeading">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                                href="#{{prefix}}MethodologyContent"
                                aria-expanded="true" aria-controls="{{prefix}}Interpretation">
                                Methodology
                            </a>
                        </h4>
                    </div>

                    <div id="{{prefix}}MethodologyContent" class="panel-collapse collapse" role="tabpanel"
                            aria-labelledby="{{prefix}}MethodologyHeading">
                        <div class="panel-body">
                            <div id="{{prefix}}FillInputsMethodologyDiv">
                                <label class="labelReportFilter">PCR amplification and direct sequentiation of region:</label>
                                <input type="text" class$="form-control input-sm {{prefix}}PCRAmp" id="{{prefix}}PCRAmpInput" placeholder="___"
                                        aria-describedby="basic-addon1" value="{{dataFields.PCRAmp::input}}">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Methodology -->

            <!-- Other information -->
            <div class="panel panel-default" id="{{prefix}}OtherInformationDiv">
                <div class="panel-heading" role="tab" id="{{prefix}}OtherInformationHeading">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#{{prefix}}Accordion"
                           href="#{{prefix}}OtherInformationContent" aria-expanded="true"
                           aria-controls="{{prefix}}OtherInformationContent">
                            Other Information
                            <div style="float: right" class="tooltip-div">
                                <a data-toggle="tooltip" title="Other information">
                                    <i class="fa fa-info-circle" aria-hidden="true"></i>
                                </a>
                            </div>
                        </a>
                    </h4>
                </div>
                <div id="{{prefix}}OtherInformationContent" class="panel-collapse collapse" role="tabpanel"
                     aria-labelledby="{{prefix}}OtherInformationHeading">
                    <div class="panel-body">
                        <div class="form-group">
                            <div id="{{prefix}}editableConclusion">

                                <label class="labelReportFilter">Select</label>
                                <br>
                                <input type="checkbox" name="otherButtons" id="{{prefix}}Conclusions" value="conclusions"
                                       class$="{{prefix}}FilterRadio" on-change="showConclusions"
                                       style="padding-left: 20px"> Other comments<br>
                            </div>
                            <div id="{{prefix}}attached1Div">
                                <input type="checkbox" name="prioritizationButtons" checked id="{{prefix}}attached1"
                                       value="attached1" class$="{{prefix}}FilterRadio" on-change="showAttached1"
                                       style="padding-left: 20px"> Gene panel<br>
                            </div>
                            <div id="{{prefix}}filterSummaryHeaderDiv">
                                <input type="checkbox" name="prioritizationButtons" id="{{prefix}}FilterResume"
                                       value="filterResume" class$="{{prefix}}FilterRadio" on-change="showAttached2"
                                       style="padding-left: 20px"> Prioritization filter<br>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>

        <!--&lt;!&ndash; Modal dialog for Analysis Browser&ndash;&gt;-->
        <!--<div class="modal fade" id="{{prefix}}AnalysisBrowser" tabindex="-1" role="dialog"-->
        <!--aria-labelledby="sampleBrowserLabel">-->
        <!--<div class="modal-dialog modal-lg" role="document" style="width: 1024px;">-->
        <!--<div class="modal-content">-->
        <!--<div class="modal-header">-->
        <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span-->
        <!--aria-hidden="true">&times;</span></button>-->
        <!--<h4 class="modal-title" id="{{prefix}}AnalysisBrowserLabel">Analysis Selector</h4>-->
        <!--</div>-->
        <!--<div class="modal-body" style="height: 650px">-->
        <!--&lt;!&ndash;<variant-clinical-selector opencga-client="{{opencgaClient}}" analysis="{{analysis}}" analysis-selected="{{analysisSelected}}"></variant-clinical-selector>&ndash;&gt;-->
        <!--<variant-clinical-selector opencga-client="{{opencgaClient}}"-->
        <!--analysis-selected="{{analysisSelected}}" study="{{study}}"-->
        <!--analysis-modal="{{analysisModal}}"-->
        <!--show-pedigree="{{showPedigree}}"></variant-clinical-selector>-->
        <!--</div>-->
        <!--<div class="modal-footer">-->
        <!--<button type="button" class="btn btn-primary" data-dismiss="modal" on-click="showReportOptions">-->
        <!--OK-->
        <!--</button>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <div style="width: 60%;margin: 0 auto">
            <button type="button" class="btn btn-primary btn-md" style="width: 100%" on-click="onSave" disabled>
                <i class="fa fa-floppy-o" aria-hidden="true" style="padding: 0px 5px 0px 5px"></i>
                Save report
            </button>
        </div>
        <br>
        <div style="width: 60%;margin: 0 auto">
            <button type="button" class="btn btn-primary btn-md" style="width: 100%" on-click="onExport">
                <i class="fa fa-file-pdf-o" aria-hidden="true" style="padding: 0px 5px 0px 5px"></i>
                Export report
            </button>

        </div>
        <opencga-message-dialog opencga-client="{{opencgaClient}}" show-message-modal="{{showMessageModal}}"
                                settings-message-modal="{{settingsMessageModal}}"></opencga-message-dialog>
    </template>

    <script>
        class VariantReportFilter extends Polymer.Element {
            static get is() {
                return 'variant-report-filter'
            }

            static get properties() {
                return {
                    opencgaSession: {
                        type: Object,
                        observer: 'updateVariableSets'
                    },
                    opencgaClient: {
                        type: Object
                    },
                    prefix: {
                        type: String
                    },
                    config: {
                        type: Object
                    },
                    selection: {
                        type: Object,
                        notify: true
                    },
                    variables: {
                        type: Array,
                        notify: true
                    },
                    expReport: {
                        type: Boolean,
                        notify: true
                    },
                    analysisSelected: {
                        type: Object
                    },
                    dataFields: {
                        type:Object,
                        notify: true
                    },
                    interpretation: {
                        type: Object,
                        observer: 'onInterpretationChanged',
                    },
                    i18n: {
                        type: Object
                    },
                }

            }

            static get observers() {
                return [
                    'updateDataFields(dataFields.*)',
                    'onModeOfInheritanceChanged(dataFields.inheritance)',
                ]
            }

            constructor() {
                super();
            }

            _attachDom(dom) {
                this.appendChild(dom);
            }


            ready() {
                super.ready();
                if (UtilsNew.isEmpty(this.prefix)) {
                    this.prefix = "repFilter" + Utils.randomString(6);
                }
                this.showPedigree = false;
                this.dataFields = {
                    reasonConsultation: "",
                    diseaseHeader: "",
                    applicant: "",
                    department: "",
                    city: "",
                    patient: "",
                    nuhsa: "",
                    familyNumber: "",
                    analysisType: "",
                    entryDate: "",
                    relationship: "",
                    depth: "",
                    extraInterpretation: "",
                    coverage: "",
                    signLeft: "",
                    signRight: "",
                    birthYear: "",
                    extraRelationship: ""
                };
            }

            connectedCallback(){
                super.connectedCallback();
                if (UtilsNew.isNotUndefinedOrNull(this.interpretation) && UtilsNew.isNotUndefinedOrNull(this.interpretation.attributes) && UtilsNew.isNotUndefinedOrNull(this.interpretation.attributes.panelInfo)) {
                    this.dataFields.reasonConsultation = this.interpretation.attributes.panelInfo.panel;
                    this.dataFields.diseaseHeader = this.interpretation.attributes.panelInfo.panel;
                    this.dataFields = Object.assign({},this.dataFields);
                }
                this.showReportOptions();
            }

            loadi18n(key) {
                // HACK!!! i18n exists as a global variable; no need to pass it
                return !!key ? (i18n.es.clinical.report[key] || `Key does not exists: ${key}`) : "-";
                // return (!!this.i18n && this.i18n[key]) || `Key does not exists: ${key}`;
            };

            updateDataFields(newValue, oldValue) {
                if (!!this.dataFields.inheritance) {
                    switch(this.dataFields.inheritance) {
                        case "autoDominant":
                            this.prenatalModes = [
                                { id: "dominant", value: "Diagnóstico Prenatal, autosómico dominante" },
                            ];
                            break;
                        case "autoRecessive":
                            this.prenatalModes = [
                                { id: "recessive_1", value: "Diagnóstico Prenatal, autosómico recesivo (no se conoce el estado de portador de ambos miembros de la pareja)"} ,
                                { id: "recessive_2", value: "Diagnóstico Prenatal, autosómico recesivo (se conoce el estado de portador de ambos miembros de la pareja)" }
                            ];
                            break;
                        case "xLinked":
                            this.prenatalModes = [
                                { id: "xlinked_1", value: "Diagnóstico Prenatal, ligado al X" },
                                { id: "xlinked_2", value: "Diagnóstico Prenatal, ligado al X, madre no portadora" }
                            ];
                            break;
                        default:
                            this.prenatalModes = [];
                            break;
                    }
                } else {
                    this.prenatalModes = [];
                }
                if (!!newValue && !!oldValue && JSON.stringify(newValue) !== JSON.stringify(oldValue)) {
                    this.dataFields = { ...this.dataFields };
                }
            }

            updateVariableSets() {
                this.variables = [];
                let _this = this;
                this.opencgaClient.studies().info(this.opencgaSession.study.id, {include: "variableSets"})
                    .then(function (response) {
                        _this.variableSets = response.response[0].result[0].variableSets;
                        if (_this.variableSets.length > 0) {
                            _this.variables = _this.variableSets[0].variables; // setting first one by default
                            _this.filteredVariables = {
                                variableSet: _this.variableSets[0].id,
                                variables: []
                            };
                        } else {
                            _this.variableSets = [{name: "none"}];
                        }
                    })
                    .catch(function () {
                        console.log("Could not obtain the variable sets of the study " + _this.opencgaSession.study);
                    });
            }

            _sortVariables(a, b) {
                return a.rank < b.rank ? -1 : (a.rank > b.rank ? 1 : 0);
            }

            sampleInfoField() {
                let field = PolymerUtils.getElementById(this.prefix + "SampleFields");
                let fields = PolymerUtils.querySelectorAll("input[type='checkbox']", field);
                let fieldsAux = [];
                if (fields.length > 0) {
                    for (let i = 0; i < fields.length; i++) {
                        fieldsAux.push({name: fields[i].value, value: fields[i].checked});
                    }
                }

                let _obj = Object.assign({}, this.selection, {sampleInfo: fieldsAux});
                this.selection = _obj;

            }

            sampleInfoAll() {
                let field = PolymerUtils.getElementById(this.prefix + "SampleFields");
                let fields = PolymerUtils.querySelectorAll("input[type='checkbox']", field);
                for (let i = 0; i < fields.length; i++) {
                    PolymerUtils.setPropertyById(fields[i].id, "checked", true);
                    PolymerUtils.setAttribute(fields[i].id, "disabled", true);
                }
                this.sampleInfoField();

            }

            sampleInfoSubset() {
                let field = PolymerUtils.getElementById(this.prefix + "SampleFields");
                let fields = PolymerUtils.querySelectorAll("input[type='checkbox']", field);
                for (let i = 0; i < fields.length; i++) {
                    PolymerUtils.removeAttribute(fields[i].id, "disabled");
                }
            }

            onExport() {
                this.expReport = true;

//                this.settingsMessageModal = {
//                    messageHeader: "Warning",
//                    messageBody: ["To be implemented"],
//                    type: "danger",
//                    height: "100px",
//                    width: "500px"
//                };
//                this.showMessageModal = true;
            }

            onSave() {
                this.settingsMessageModal = {
                    messageHeader: "Warning",
                    messageBody: ["To be implemented"],
                    type: "danger",
                    height: "100px",
                    width: "500px"
                };
                this.showMessageModal = true;
            }

            showReportOptions() {
//                e.preventDefault(); // prevents the hash change to "#" and allows to manipulate the hash fragment as needed
//                    PolymerUtils.show(this.prefix + "PrioritizationInformationDiv");
//                    PolymerUtils.show(this.prefix + "OtherInformationDiv");
                if (UtilsNew.isNotUndefinedOrNull(this.analysisSelected)) {
                    this.showAnalysisSelecteDefault();
                    PolymerUtils.setValue(this.prefix + "FilterTextInput",this.analysisSelected.name);

                }
            }

            showAnalysisSelecteDefault(){
                PolymerUtils.show(this.prefix + "analysisSelectedDiv");
                PolymerUtils.show(this.prefix + "SampleInformationDiv");
                PolymerUtils.show(this.prefix + "analysisResumeDiv");


                this.currentAnalysisID = this.analysisSelected.analysisID;
                let _obj = Object.assign({}, this.selection, {analysisSelected: true});
                this.selection = _obj;
            }

            showAnalysisResume(e) {
                e.preventDefault();
                let _obj = Object.assign({}, this.selection, {analysisResume: e.target.checked});
                this.selection = _obj;
            }

            showPedigreeIn(e) {
                e.preventDefault();
                if (this.analysisSelected.type === "TRIO" || this.analysisSelected.type === "DUO" || this.analysisSelected.type === "FAMILY") {
                    let _obj = Object.assign({}, this.selection, {pedigree: e.target.checked});
                    this.selection = _obj;
                }
            }

            showPrioritization(e) {
                e.preventDefault();
                let field = PolymerUtils.getElementById(this.prefix + "PrioritizationFields");
                let fields = PolymerUtils.querySelectorAll("input[type='checkbox']", field);
                let fieldsAux = [];
                if (fields.length > 0) {
                    for (let i = 0; i < fields.length; i++) {
                        fieldsAux.push({name: fields[i].value, value: fields[i].checked});
                    }
                }

                let _obj = Object.assign({}, this.selection, {prioritizationInfo: fieldsAux});
                this.selection = _obj;
            }

            showAttached1(e) {
                e.preventDefault();
                let _obj = Object.assign({}, this.selection, {attached1: e.target.checked});
                this.selection = _obj;
            }
            showAttached2(e) {
                e.preventDefault();
                let _obj = Object.assign({}, this.selection, {attached2: e.target.checked});
                this.selection = _obj;
            }

            showConclusions(e) {
                e.preventDefault();
                let _obj = Object.assign({}, this.selection, {conclusions: e.target.checked});
                this.selection = _obj;
            }

            changeRelationshipSelect(e) {
                let relationshipSelected = e.target.value;
                if (relationshipSelected !== this.loadi18n('proband')) {
                    PolymerUtils.show(this.prefix + "extraRelationship");
                } else {
                    PolymerUtils.hide(this.prefix + "extraRelationship");
                    this.dataFields.extraRelationship = "";
                    this.dataFields = Object.assign({},this.dataFields)

                }
            }

            changeSign(e) {
                let drsSign = [];
                drsSign.push("");
                drsSign.push(this.loadi18n('dr') + this.loadi18n('antinolo'));
                drsSign.push(this.loadi18n('dra') + this.loadi18n('borrego'));
                drsSign.push(this.loadi18n('dra') + this.loadi18n('mendez'));
                drsSign.push(this.loadi18n('dra') + this.loadi18n('bravo'));
                drsSign.push(this.loadi18n('dra') + this.loadi18n('fernandez'));
                drsSign.push(this.loadi18n('dra') + this.loadi18n('marcos'));

                let toModify = e.target.id === this.prefix + "SignLeftSelect" ? this.prefix + "SignRightSelect" : this.prefix + "SignLeftSelect";
                let lastValue = e.target.id === this.prefix + "SignLeftSelect" ? this.dataFields.signRight : this.dataFields.signLeft;
                let options = "";
                drsSign.forEach((doctor) => {
                    if (doctor !== e.target.value) {
                        if (lastValue === doctor) {
                            options += `<option selected value="${doctor}">${doctor}</option>`;
                        } else {
                            options += `<option value="${doctor}">${doctor}</option>`;
                        }
                    }
                });
                PolymerUtils.innerHTML(toModify,options);

            }

            isParentalModeEnabled() {
                return !!this.dataFields.inheritance && ["autoRecessive", "xLinked"].includes(this.dataFields.inheritance);
            }

            onInterpretationChanged() {
                if (!!this.interpretation && !!this.interpretation.attributes && !!this.interpretation.attributes.inheritance) {
                    this.dataFields.inheritance = this.interpretation.attributes.inheritance;
                }
            }

            onModeOfInheritanceChanged() {
                $(`#${this.prefix}PrenatalMode`).val("");
                delete this.dataFields.inheritancePrenatal;
            }
        }

        customElements.define(VariantReportFilter.is, VariantReportFilter);

    </script>
</dom-module>